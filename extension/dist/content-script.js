const p=["article",'[role="article"]',"main article","main",'[role="main"]',".article-body",".post-content",".entry-content",".content__article-body",".story-body",".article-content","#article-body",".article"];function s(t){return t?t.replace(/\r/g,"").replace(/\t+/g," ").replace(/[ \u00A0]+/g," ").replace(/\n{3,}/g,`

`).trim():""}function a(){const t=document.querySelector("h1")?.textContent?.trim()||document.title||"",e=document.querySelector('meta[name="description"]')?.getAttribute("content")||"",r=location.href;return{title:t,description:e,url:r}}function A(){for(const t of p)try{const e=document.querySelector(t);if(!e)continue;if((Array.from(e.querySelectorAll("p")).map(n=>n.textContent?.trim()||"").join(" ")||"").length>120/2||(e.textContent||"").trim().length>120)return e}catch{}return null}function u(t){return Array.from(t.querySelectorAll("p")).map(r=>s(r.textContent)).filter(Boolean).join(`

`)}function x(){const t=Array.from(document.querySelectorAll("p"));if(!t.length)return null;const e=new Map;for(const n of t){const c=n.parentElement||document.body,o=(n.textContent||"").length;e.set(c,(e.get(c)||0)+o)}const r=Array.from(e.entries()).sort((n,c)=>c[1]-n[1])[0];return r?r[0]:null}function m(){const{title:t,description:e}=a(),r=A();if(r){const o=u(r)||s(r.textContent||"");if(o&&o.length>=120)return{title:t,description:e,text:o.slice(0,1e4)}}const n=x();if(n){const o=u(n)||s(n.textContent||"");if(o&&o.length>=120)return{title:t,description:e,text:o.slice(0,1e4)}}const c=s(document.body.innerText);return c&&c.length>=300?{title:t,description:e,text:c.slice(0,1e4)}:{}}function d(t){try{chrome.runtime.sendMessage(t,()=>{chrome.runtime.lastError})}catch{}}let l=null;function i(t=400){l&&window.clearTimeout(l),l=window.setTimeout(()=>{l=null,f()},t)}function f(){const{title:t,description:e,url:r}=a(),n=m();n.text&&n.text.length>=120?d({action:"articleDetected",url:r,title:n.title||t,description:n.description||e,text:n.text,timestamp:Date.now()}):d({action:"articleNotFound",url:r,timestamp:Date.now()})}chrome.runtime.onMessage.addListener((t,e,r)=>{const n=t;if(n?.action==="getArticleText"){const c=a(),o=m();return r({success:!!o.text,title:o.title||c.title,description:o.description||c.description,url:c.url,text:o.text||null}),!0}else if(n?.action==="forceDetect")return f(),r({success:!0}),!0;return!1});document.readyState==="complete"||document.readyState==="interactive"?i(100):window.addEventListener("DOMContentLoaded",()=>i(100));const y=new MutationObserver(()=>i(600));y.observe(document.body,{childList:!0,subtree:!0});window.addEventListener("popstate",()=>i(300));window.addEventListener("pushstate",()=>i(300));
